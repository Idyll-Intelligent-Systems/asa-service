<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ARK: Survival Ascended - Official Wiki Location Finder</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Modern 3D CSS Variables */
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --dark-gradient: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --shadow-3d: 0 20px 50px rgba(0, 0, 0, 0.3);
      --shadow-hover: 0 30px 60px rgba(0, 0, 0, 0.4);
      --border-radius: 20px;
      --animation-speed: 0.3s;
      --perspective: 1000px;
    }

    /* Global Reset & 3D Setup */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--dark-gradient);
      color: #ffffff;
      overflow-x: hidden;
      perspective: var(--perspective);
      min-height: 100vh;
    }

    /* 3D Background Animation */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 20%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
      animation: backgroundFloat 20s ease-in-out infinite;
      z-index: -1;
    }

    @keyframes backgroundFloat {
      0%, 100% { opacity: 0.3; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.1); }
    }

    /* Modern Container with Glass Effect */
    .main-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      position: relative;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header styling */
    .header {
      background: linear-gradient(135deg, var(--primary), #0056b3);
      color: white;
      padding: 1.5rem;
      margin: -2rem -2rem 2rem -2rem;
      border-radius: 12px 12px 0 0;
      text-align: center;
    }

    .header h1 {
      margin: 0;
      font-size: 2.5rem;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .header p {
      margin: 0.5rem 0 0 0;
      opacity: 0.9;
      font-size: 1.1rem;
    }

    /* Status banner */
    .status-banner {
      background: var(--surface-variant);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .status-badge {
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .status-online { 
      background: var(--success); 
      color: white; 
    }

    .status-csv { 
      background: var(--warning); 
      color: var(--dark); 
    }

    .status-offline { 
      background: var(--danger); 
      color: white; 
    }

    /* Card styling */
    .card {
      background: var(--surface-variant);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 8px var(--shadow);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
    }

    /* Navigation tabs */
    .nav-tabs {
      display: flex;
      background: var(--surface-variant);
      border-radius: 8px;
      padding: 0.25rem;
      margin-bottom: 2rem;
      gap: 0.25rem;
    }

    .nav-tab {
      flex: 1;
      padding: 1rem;
      background: transparent;
      border: none;
      border-radius: 6px;
      color: var(--on-surface-variant);
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .nav-tab:hover {
      background: var(--border);
      color: var(--on-surface);
    }

    .nav-tab.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 2px 4px rgba(13, 110, 253, 0.3);
    }

    /* Tab content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Form styling */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    label {
      color: var(--on-surface);
      font-weight: 600;
      font-size: 0.9rem;
    }

    input, select, textarea {
      background: var(--surface-variant);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.75rem;
      color: var(--on-surface);
      font-size: 1rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
    }

    /* Button styling */
    button {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1rem;
    }

    button:hover {
      background: #0056b3;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    button:active {
      transform: translateY(0);
    }

    button.secondary {
      background: var(--surface-variant);
      color: var(--on-surface);
      border: 1px solid var(--border);
    }

    button.secondary:hover {
      background: var(--border);
    }

    button.success {
      background: var(--success);
    }

    button.danger {
      background: var(--danger);
    }

    /* Map visualization */
    .map-container {
      background: var(--surface-variant);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      position: relative;
      overflow: hidden;
    }

    .map-image {
      width: 100%;
      height: 400px;
      background-size: cover;
      background-position: center;
      border-radius: 6px;
      position: relative;
      border: 2px solid var(--border);
      background-color: var(--surface);
    }

    .coordinate-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .lat-line, .lon-line {
      position: absolute;
      background: rgba(255, 255, 255, 0.3);
      font-size: 10px;
      color: white;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    }

    .lat-line {
      height: 1px;
      width: 100%;
      left: 0;
    }

    .lon-line {
      width: 1px;
      height: 100%;
      top: 0;
    }

    /* Map selector */
    .map-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }

    .map-option {
      background: var(--surface-variant);
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .map-option:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px var(--shadow);
    }

    .map-option.selected {
      border-color: var(--primary);
      background: rgba(13, 110, 253, 0.1);
    }

    .map-preview {
      width: 100%;
      height: 100px;
      background-size: cover;
      background-position: center;
      border-radius: 4px;
      margin-bottom: 0.5rem;
      border: 1px solid var(--border);
      background-color: var(--surface);
    }

    /* Data table */
    .data-table {
      width: 100%;
      background: var(--surface-variant);
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--border);
      border-collapse: collapse;
    }

    .data-table th {
      background: var(--primary);
      color: white;
      padding: 1rem;
      text-align: left;
      font-weight: 600;
    }

    .data-table td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border);
    }

    .data-table tr:hover {
      background: var(--border);
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-top: 1rem;
    }

    .pagination button {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
    }

    /* Modal styling */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .modal-content {
      background: var(--surface);
      margin: 5% auto;
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .close {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--on-surface-variant);
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
    }

    /* Loading states */
    .loading {
      position: relative;
      pointer-events: none;
      opacity: 0.7;
    }

    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin: -10px 0 0 -10px;
      border: 2px solid var(--primary);
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Toast notifications */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transform: translateX(400px);
      transition: transform 0.3s ease;
      z-index: 1001;
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast.error {
      background: var(--danger);
    }

    .toast.warning {
      background: var(--warning);
      color: var(--dark);
    }

    /* Progress indicators */
    .progress {
      width: 100%;
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--info));
      animation: progress 2s ease-in-out infinite;
    }

    @keyframes progress {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Footer */
    .footer {
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
      text-align: center;
      color: var(--on-surface-variant);
      font-size: 0.9rem;
    }

    /* 3D Glass Card Component */
    .glass-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-3d);
      padding: 2rem;
      margin: 1rem 0;
      transform-style: preserve-3d;
      transition: all var(--animation-speed) ease;
      position: relative;
      overflow: hidden;
    }

    .glass-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: shimmer 3s ease-in-out infinite;
    }

    @keyframes shimmer {
      0%, 100% { opacity: 0; }
      50% { opacity: 1; }
    }

    .glass-card:hover {
      transform: translateY(-5px) rotateX(2deg);
      box-shadow: var(--shadow-hover);
    }

    /* 3D Header with Perspective */
    .header-3d {
      text-align: center;
      margin-bottom: 3rem;
      transform-style: preserve-3d;
    }

    .header-3d h1 {
      font-size: 3.5rem;
      font-weight: 700;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 1rem;
      transform: translateZ(50px);
      text-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
      animation: titleFloat 4s ease-in-out infinite;
    }

    @keyframes titleFloat {
      0%, 100% { transform: translateZ(50px) translateY(0px); }
      50% { transform: translateZ(50px) translateY(-10px); }
    }

    .header-3d .subtitle {
      font-size: 1.2rem;
      color: rgba(255, 255, 255, 0.7);
      transform: translateZ(30px);
    }

    /* 3D Button Components */
    .btn-3d {
      background: var(--primary-gradient);
      border: none;
      border-radius: 15px;
      color: white;
      padding: 1rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      position: relative;
      transform-style: preserve-3d;
      transition: all var(--animation-speed) ease;
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      overflow: hidden;
    }

    .btn-3d::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .btn-3d:hover::before {
      left: 100%;
    }

    .btn-3d:hover {
      transform: translateY(-3px) rotateX(5deg);
      box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
    }

    .btn-3d:active {
      transform: translateY(-1px) rotateX(2deg);
    }

    /* 3D Input Fields */
    .input-3d {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      color: white;
      padding: 1rem 1.5rem;
      font-size: 1rem;
      width: 100%;
      transition: all var(--animation-speed) ease;
      transform-style: preserve-3d;
      backdrop-filter: blur(10px);
    }

    .input-3d:focus {
      outline: none;
      border-color: rgba(102, 126, 234, 0.8);
      box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
      transform: translateZ(10px);
    }

    .input-3d::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    /* 3D Grid Layout */
    .grid-3d {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }

    .grid-item-3d {
      transform-style: preserve-3d;
      transition: all var(--animation-speed) ease;
    }

    .grid-item-3d:hover {
      transform: translateZ(20px);
    }

    /* Status Indicator 3D */
    .status-3d {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 50px;
      padding: 0.8rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      z-index: 1000;
      transform-style: preserve-3d;
      animation: statusFloat 3s ease-in-out infinite;
    }

    @keyframes statusFloat {
      0%, 100% { transform: translateY(0px) rotateY(0deg); }
      50% { transform: translateY(-5px) rotateY(5deg); }
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--success-gradient);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.2); }
    }

    /* Map Container 3D */
    .map-container-3d {
      position: relative;
      width: 100%;
      height: 500px;
      border-radius: var(--border-radius);
      overflow: hidden;
      transform-style: preserve-3d;
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
    }

    .map-3d {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: all var(--animation-speed) ease;
      transform-style: preserve-3d;
    }

    .map-3d:hover {
      transform: scale(1.05) rotateX(5deg);
    }

    /* Coordinate Grid Overlay */
    .coordinate-grid {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      background-image: 
        linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px);
      background-size: 50px 50px;
      opacity: 0;
      transition: opacity var(--animation-speed) ease;
    }

    .coordinate-grid.active {
      opacity: 0.6;
    }

    /* Map Markers 3D */
    .map-marker-3d {
      position: absolute;
      width: 20px;
      height: 20px;
      background: var(--secondary-gradient);
      border-radius: 50%;
      border: 2px solid white;
      transform: translateZ(30px);
      cursor: pointer;
      animation: markerPulse 2s ease-in-out infinite;
      box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
    }

    @keyframes markerPulse {
      0%, 100% { transform: translateZ(30px) scale(1); }
      50% { transform: translateZ(30px) scale(1.2); }
    }

    .map-marker-3d::after {
      content: '';
      position: absolute;
      top: -5px;
      left: -5px;
      width: 30px;
      height: 30px;
      border: 2px solid rgba(245, 87, 108, 0.3);
      border-radius: 50%;
      animation: markerRipple 2s ease-in-out infinite;
    }

    @keyframes markerRipple {
      0% { transform: scale(0.5); opacity: 1; }
      100% { transform: scale(2); opacity: 0; }
    }

    /* Results Container 3D */
    .results-3d {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }

    .result-card-3d {
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      border-radius: 15px;
      padding: 1.5rem;
      transform-style: preserve-3d;
      transition: all var(--animation-speed) ease;
      position: relative;
      overflow: hidden;
    }

    .result-card-3d::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--primary-gradient);
      transform: scaleX(0);
      transition: transform var(--animation-speed) ease;
    }

    .result-card-3d:hover::before {
      transform: scaleX(1);
    }

    .result-card-3d:hover {
      transform: translateY(-3px) rotateX(2deg) rotateY(1deg);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }

    /* Loading Animation 3D */
    .loading-3d {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
      transform-style: preserve-3d;
    }

    .loading-spinner-3d {
      width: 60px;
      height: 60px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top: 3px solid var(--primary-gradient);
      border-radius: 50%;
      animation: spin3d 1s linear infinite;
      transform-style: preserve-3d;
    }

    @keyframes spin3d {
      0% { transform: rotateY(0deg) rotateX(0deg); }
      25% { transform: rotateY(90deg) rotateX(0deg); }
      50% { transform: rotateY(180deg) rotateX(90deg); }
      75% { transform: rotateY(270deg) rotateX(180deg); }
      100% { transform: rotateY(360deg) rotateX(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header-3d h1 {
        font-size: 2.5rem;
      }
      
      .grid-3d {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .main-container {
        padding: 1rem;
      }
      
      .status-3d {
        position: relative;
        top: auto;
        right: auto;
        margin-bottom: 1rem;
        justify-self: center;
      }
    }

    /* Utility Classes */
    .text-center { text-align: center; }
    .mb-1 { margin-bottom: 0.5rem; }
    .mb-2 { margin-bottom: 1rem; }
    .mb-3 { margin-bottom: 1.5rem; }
    .mt-2 { margin-top: 1rem; }
    .p-1 { padding: 0.5rem; }
    .p-2 { padding: 1rem; }
    
    .fade-in {
      animation: fadeIn 0.6s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <!-- 3D Status Indicator -->
    <div class="status-3d" id="statusIndicator">
      <div class="status-dot"></div>
      <span id="statusText">Connected</span>
    </div>

    <!-- 3D Header -->
    <div class="header-3d">
      <h1>ARK: Survival Ascended</h1>
      <p class="subtitle">Official Wiki Location Finder & Resource Database - Real-time Sync with ARK Wiki</p>
    </div>

    <!-- Navigation Tabs -->
    <div class="glass-card">
      <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('search')">
          <i class="fas fa-search"></i> Location Search
        </button>
        <button class="nav-tab" onclick="switchTab('tame')">
          <i class="fas fa-calculator"></i> Tame Calculator
        </button>
        <button class="nav-tab" onclick="switchTab('browse')">
          <i class="fas fa-table"></i> Browse Data
        </button>
        <button class="nav-tab" onclick="switchTab('admin')">
          <i class="fas fa-sync-alt"></i> Wiki Sync
        </button>
      </div>
    </div>

    <!-- Search Tab Content -->
    <div class="tab-content active" id="searchTab">
      <!-- Main Control Panel -->
      <div class="glass-card">
        <h2 style="margin-bottom: 2rem; background: var(--secondary-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
          <i class="fas fa-search"></i> Location Search
        </h2>
      
      <div class="grid-3d">
        <div class="grid-item-3d">
          <label for="mapSelect" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Select Map</label>
          <select id="mapSelect" class="input-3d">
            <option value="">Choose a map...</option>
          </select>
        </div>
        
        <div class="grid-item-3d">
          <label for="typeSelect" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Category</label>
          <select id="typeSelect" class="input-3d">
            <option value="">Choose category...</option>
          </select>
        </div>
      </div>

      <div class="grid-3d">
        <div class="grid-item-3d">
          <label for="lat" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Latitude</label>
          <input type="number" id="lat" class="input-3d" placeholder="Enter latitude..." step="0.1" />
        </div>
        
        <div class="grid-item-3d">
          <label for="lon" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Longitude</label>
          <input type="number" id="lon" class="input-3d" placeholder="Enter longitude..." step="0.1" />
        </div>
      </div>

      <div class="text-center mt-2">
        <button id="searchBtn" class="btn-3d">
          <i class="fas fa-search"></i> Find Nearest Locations
        </button>
      </div>
    </div>

    <!-- 3D Map Display Container -->
    <div class="glass-card" id="mapContainer" style="display: none;">
      <h2 style="margin-bottom: 1rem; background: var(--success-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
        <i class="fas fa-map"></i> Interactive Map View
      </h2>
      
      <div class="map-container-3d">
        <img id="mapImage" class="map-3d" alt="Map View" />
        <div class="coordinate-grid" id="coordinateGrid"></div>
        <div id="mapMarkers"></div>
      </div>
      
      <div class="text-center mt-2">
        <button id="toggleGrid" class="btn-3d" style="background: var(--success-gradient);">
          <i class="fas fa-th"></i> Toggle Grid
        </button>
        <button id="resetView" class="btn-3d" style="background: var(--secondary-gradient); margin-left: 1rem;">
          <i class="fas fa-refresh"></i> Reset View
        </button>
      </div>
    </div>

    <!-- 3D Results Display -->
    <div class="glass-card" id="resultsContainer" style="display: none;">
      <h2 style="margin-bottom: 2rem; background: var(--primary-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
        <i class="fas fa-list"></i> Search Results
      </h2>
      <div id="results" class="results-3d"></div>
    </div>
    </div>

    <!-- Tame Calculator Tab Content -->
    <div class="tab-content" id="tameTab">
      <div class="glass-card">
        <h2 style="margin-bottom: 2rem; background: var(--success-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
          <i class="fas fa-calculator"></i> Tame Calculator
        </h2>
        
        <div class="grid-3d">
          <div class="grid-item-3d">
            <label for="dinoSelect" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Creature</label>
            <select id="dinoSelect" class="input-3d">
              <option value="">Select creature...</option>
              <option value="Raptor">Raptor</option>
              <option value="Rex">Rex</option>
              <option value="Trike">Trike</option>
              <option value="Spino">Spino</option>
            </select>
          </div>
          
          <div class="grid-item-3d">
            <label for="dinoLevel" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Creature Level</label>
            <input type="number" id="dinoLevel" class="input-3d" placeholder="Enter level (10-150)" min="10" max="150" />
          </div>
        </div>

        <div class="text-center mt-2">
          <button id="calculateBtn" class="btn-3d">
            <i class="fas fa-calculator"></i> Calculate Taming Requirements
          </button>
        </div>

        <div id="tameResults" class="glass-card" style="display: none; margin-top: 2rem;">
          <h3 style="margin-bottom: 1rem; color: #fff;">Taming Results</h3>
          <div id="tameResultsContent"></div>
        </div>
      </div>
    </div>

    <!-- Browse Data Tab Content -->
    <div class="tab-content" id="browseTab">
      <div class="glass-card">
        <h2 style="margin-bottom: 2rem; background: var(--primary-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
          <i class="fas fa-table"></i> Browse All Data
        </h2>
        
        <div class="grid-3d">
          <div class="grid-item-3d">
            <label for="browseMapSelect" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Select Map</label>
            <select id="browseMapSelect" class="input-3d">
              <option value="">Choose a map...</option>
            </select>
          </div>
          
          <div class="grid-item-3d">
            <label for="browseCategorySelect" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Category</label>
            <select id="browseCategorySelect" class="input-3d">
              <option value="">Choose category...</option>
            </select>
          </div>
        </div>

        <div class="grid-3d">
          <div class="grid-item-3d">
            <label for="searchFilter" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Search Filter</label>
            <input type="text" id="searchFilter" class="input-3d" placeholder="Filter by name..." />
          </div>
          
          <div class="grid-item-3d" style="display: flex; align-items: end;">
            <button id="browseBtn" class="btn-3d" style="width: 100%;">
              <i class="fas fa-search"></i> Browse Data
            </button>
          </div>
        </div>

        <div id="browseResults" class="glass-card" style="display: none; margin-top: 2rem;">
          <h3 style="margin-bottom: 1rem; color: #fff;">Browse Results</h3>
          <div id="browseResultsContent"></div>
          <div id="browsePagination" class="text-center mt-2"></div>
        </div>
      </div>
    </div>

    <!-- Admin/Wiki Sync Tab Content -->
    <div class="tab-content" id="adminTab">
      <div class="glass-card">
        <h2 style="margin-bottom: 2rem; background: var(--secondary-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
          <i class="fas fa-sync-alt"></i> Wiki Data Synchronization
        </h2>
        
        <div class="glass-card" style="background: rgba(255, 255, 255, 0.05); margin-bottom: 2rem;">
          <h3 style="color: #fff; margin-bottom: 1rem;">
            <i class="fas fa-info-circle"></i> Sync Status
          </h3>
          <div id="syncStatus" class="grid-3d">
            <div class="result-card-3d">
              <div style="text-align: center;">
                <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Last Sync</div>
                <div id="lastSyncTime" style="font-weight: 600; color: #4facfe;">Never</div>
              </div>
            </div>
            <div class="result-card-3d">
              <div style="text-align: center;">
                <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Total Records</div>
                <div id="totalRecords" style="font-weight: 600; color: #00f2fe;">Loading...</div>
              </div>
            </div>
            <div class="result-card-3d">
              <div style="text-align: center;">
                <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Wiki Status</div>
                <div id="wikiStatus" style="font-weight: 600; color: #f093fb;">Checking...</div>
              </div>
            </div>
          </div>
        </div>

        <div class="grid-3d">
          <div class="grid-item-3d">
            <label for="syncMapSelect" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Select Map to Sync</label>
            <select id="syncMapSelect" class="input-3d">
              <option value="">All Maps</option>
            </select>
          </div>
          
          <div class="grid-item-3d">
            <label for="syncTypeSelect" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Data Type</label>
            <select id="syncTypeSelect" class="input-3d">
              <option value="">All Categories</option>
            </select>
          </div>
        </div>

        <div class="text-center mt-2">
          <button id="fullSyncBtn" class="btn-3d" style="background: var(--success-gradient); margin-right: 1rem;">
            <i class="fas fa-download"></i> Full Wiki Sync
          </button>
          <button id="deltaSyncBtn" class="btn-3d" style="background: var(--primary-gradient); margin-right: 1rem;">
            <i class="fas fa-refresh"></i> Delta Sync
          </button>
          <button id="testConnectionBtn" class="btn-3d" style="background: var(--secondary-gradient);">
            <i class="fas fa-network-wired"></i> Test Wiki Connection
          </button>
        </div>

        <div id="syncProgress" class="glass-card" style="display: none; margin-top: 2rem;">
          <h3 style="margin-bottom: 1rem; color: #fff;">
            <i class="fas fa-cog fa-spin"></i> Sync Progress
          </h3>
          <div id="syncProgressContent"></div>
          <div class="progress" style="margin-top: 1rem;">
            <div id="syncProgressBar" class="progress-bar" style="width: 0%;"></div>
          </div>
        </div>

        <div id="syncResults" class="glass-card" style="display: none; margin-top: 2rem;">
          <h3 style="margin-bottom: 1rem; color: #fff;">Sync Results</h3>
          <div id="syncResultsContent"></div>
        </div>
      </div>
    </div>

    <!-- 3D Map Display Container -->
    <div class="glass-card" id="mapContainer" style="display: none;">
      <h2 style="margin-bottom: 1rem; background: var(--success-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
        <i class="fas fa-map"></i> Interactive Map View
      </h2>
      
      <div class="map-container-3d">
        <img id="mapImage" class="map-3d" alt="Map View" />
        <div class="coordinate-grid" id="coordinateGrid"></div>
        <div id="mapMarkers"></div>
      </div>
      
      <div class="text-center mt-2">
        <button id="toggleGrid" class="btn-3d" style="background: var(--success-gradient);">
          <i class="fas fa-th"></i> Toggle Grid
        </button>

    <!-- 3D Loading Indicator -->
    <div id="loadingIndicator" class="loading-3d" style="display: none;">
      <div class="loading-spinner-3d"></div>
    </div>
  </div>

  <script>
    // Modern 3D ASA Maps Application
    class ASAMaps3D {
      constructor() {
        this.maps = [];
        this.categories = {};
        this.currentMap = null;
        this.currentResults = [];
        this.currentPage = 1;
        this.pageSize = 20;
        this.mapImages = {
          'TheIsland': '/images/maps/TheIsland.jpg',
          'TheCenter': '/images/maps/TheCenter.jpg',
          'ScorchedEarth': '/images/maps/ScorchedEarth.jpg',
          'Aberration': '/images/maps/Aberration.jpg',
          'Extinction': '/images/maps/Extinction.jpg',
          'Ragnarok': '/images/maps/Ragnarok.jpg',
          'Valguero': '/images/maps/Valguero.jpg',
          'Genesis1': '/images/maps/Genesis1.jpg',
          'Genesis2': '/images/maps/Genesis2.jpg',
          'CrystalIsles': '/images/maps/CrystalIsles.jpg',
          'Fjordur': '/images/maps/Fjordur.jpg'
        };
        
        this.init();
      }

      async init() {
        await this.loadInitialData();
        this.setupEventListeners();
        this.updateStatus('Connected', 'success');
      }

      async loadInitialData() {
        try {
          // Load maps
          const mapsResponse = await fetch('/maps');
          this.maps = await mapsResponse.json();
          this.populateMapSelects();

          // Load categories
          const categoriesResponse = await fetch('/categories');
          this.categories = await categoriesResponse.json();
          this.populateCategorySelects();

        } catch (error) {
          console.error('Error loading initial data:', error);
          this.updateStatus('Connection Error', 'error');
        }
      }

      populateMapSelects() {
        const selects = ['mapSelect', 'browseMapSelect', 'syncMapSelect'];
        selects.forEach(selectId => {
          const select = document.getElementById(selectId);
          if (select) {
            if (selectId === 'syncMapSelect') {
              select.innerHTML = '<option value="">All Maps</option>';
            } else {
              select.innerHTML = '<option value="">Choose a map...</option>';
            }
            
            this.maps.forEach(map => {
              const option = document.createElement('option');
              option.value = map;
              option.textContent = map.replace(/([A-Z])/g, ' $1').trim();
              select.appendChild(option);
            });
          }
        });
      }

      populateCategorySelects() {
        const selects = ['typeSelect', 'browseCategorySelect', 'syncTypeSelect'];
        selects.forEach(selectId => {
          const select = document.getElementById(selectId);
          if (select) {
            if (selectId === 'syncTypeSelect') {
              select.innerHTML = '<option value="">All Categories</option>';
            } else {
              select.innerHTML = '<option value="">Choose category...</option>';
            }
            
            Object.entries(this.categories).forEach(([key, category]) => {
              const option = document.createElement('option');
              option.value = key;
              option.textContent = category.name;
              select.appendChild(option);
            });
          }
        });
      }

      setupEventListeners() {
        // Search tab listeners
        document.getElementById('searchBtn').addEventListener('click', () => this.performSearch());
        document.getElementById('toggleGrid').addEventListener('click', () => this.toggleCoordinateGrid());
        document.getElementById('resetView').addEventListener('click', () => this.resetMapView());
        
        // Tame calculator listeners
        document.getElementById('calculateBtn').addEventListener('click', () => this.calculateTaming());
        
        // Browse tab listeners
        document.getElementById('browseBtn').addEventListener('click', () => this.browseData());
        
        // Admin/Sync tab listeners
        document.getElementById('fullSyncBtn').addEventListener('click', () => this.performSync(true));
        document.getElementById('deltaSyncBtn').addEventListener('click', () => this.performSync(false));
        document.getElementById('testConnectionBtn').addEventListener('click', () => this.testWikiConnection());
        
        // Map selection change
        document.getElementById('mapSelect').addEventListener('change', (e) => {
          if (e.target.value) {
            this.loadMapImage(e.target.value);
          }
        });

        // Enter key support
        ['lat', 'lon', 'dinoLevel', 'searchFilter'].forEach(id => {
          const element = document.getElementById(id);
          if (element) {
            element.addEventListener('keypress', (e) => {
              if (e.key === 'Enter') {
                if (id === 'dinoLevel') this.calculateTaming();
                else if (id === 'searchFilter') this.browseData();
                else this.performSearch();
              }
            });
          }
        });

        // Load sync status on init
        this.loadSyncStatus();
      }

      async calculateTaming() {
        const dino = document.getElementById('dinoSelect').value;
        const level = parseInt(document.getElementById('dinoLevel').value);

        if (!dino || !level || level < 10 || level > 150) {
          this.showError('Please select a creature and enter a valid level (10-150)');
          return;
        }

        this.showLoading(true);
        this.updateStatus('Calculating...', 'loading');

        try {
          const response = await fetch('/tame_calculator', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ dino, level })
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const result = await response.json();
          this.displayTameResults(result);
          this.updateStatus('Calculation Complete', 'success');

        } catch (error) {
          console.error('Taming calculation error:', error);
          this.showError(`Calculation failed: ${error.message}`);
          this.updateStatus('Calculation Failed', 'error');
        } finally {
          this.showLoading(false);
        }
      }

      displayTameResults(result) {
        const container = document.getElementById('tameResults');
        const content = document.getElementById('tameResultsContent');
        
        content.innerHTML = `
          <div class="grid-3d">
            <div class="result-card-3d">
              <h4 style="color: #4facfe; margin-bottom: 1rem;">Taming Requirements</h4>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div>
                  <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Creature</div>
                  <div style="font-weight: 600; color: #fff;">${result.dino}</div>
                </div>
                <div>
                  <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Level</div>
                  <div style="font-weight: 600; color: #fff;">${result.level}</div>
                </div>
                <div>
                  <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Tranq Arrows</div>
                  <div style="font-weight: 600; color: #f093fb;">${result.arrows}</div>
                </div>
                <div>
                  <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Estimated Time</div>
                  <div style="font-weight: 600; color: #00f2fe;">${Math.ceil(result.arrows / 10)} min</div>
                </div>
              </div>
            </div>
          </div>
        `;
        
        container.style.display = 'block';
        container.classList.add('fade-in');
      }

      async browseData() {
        const map = document.getElementById('browseMapSelect').value;
        const category = document.getElementById('browseCategorySelect').value;
        const filter = document.getElementById('searchFilter').value;

        if (!map || !category) {
          this.showError('Please select both map and category');
          return;
        }

        this.showLoading(true);
        this.updateStatus('Loading data...', 'loading');

        try {
          const response = await fetch('/browse', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              map, 
              category, 
              filter: filter || '', 
              page: this.currentPage, 
              pageSize: this.pageSize 
            })
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const result = await response.json();
          this.displayBrowseResults(result, { map, category, filter });
          this.updateStatus('Data Loaded', 'success');

        } catch (error) {
          console.error('Browse error:', error);
          this.showError(`Browse failed: ${error.message}`);
          this.updateStatus('Browse Failed', 'error');
        } finally {
          this.showLoading(false);
        }
      }

      displayBrowseResults(result, params) {
        const container = document.getElementById('browseResults');
        const content = document.getElementById('browseResultsContent');
        const pagination = document.getElementById('browsePagination');
        
        if (!result.data || result.data.length === 0) {
          content.innerHTML = `
            <div class="text-center">
              <i class="fas fa-search" style="font-size: 3rem; color: rgba(255,255,255,0.3); margin-bottom: 1rem;"></i>
              <h3>No Data Found</h3>
              <p>No entries found for the selected criteria.</p>
            </div>
          `;
          container.style.display = 'block';
          return;
        }

        // Display data in a table format
        content.innerHTML = `
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; background: rgba(255,255,255,0.05); border-radius: 10px;">
              <thead>
                <tr style="background: var(--primary-gradient);">
                  <th style="padding: 1rem; text-align: left; color: #fff; border-radius: 10px 0 0 0;">Name</th>
                  <th style="padding: 1rem; text-align: left; color: #fff;">Latitude</th>
                  <th style="padding: 1rem; text-align: left; color: #fff;">Longitude</th>
                  <th style="padding: 1rem; text-align: left; color: #fff; border-radius: 0 10px 0 0;">Type</th>
                </tr>
              </thead>
              <tbody>
                ${result.data.map((item, index) => `
                  <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); ${index % 2 === 0 ? 'background: rgba(255,255,255,0.02);' : ''}">
                    <td style="padding: 0.8rem; color: #fff;">${item.name}</td>
                    <td style="padding: 0.8rem; color: #4facfe;">${item.lat?.toFixed(2) || 'N/A'}</td>
                    <td style="padding: 0.8rem; color: #00f2fe;">${item.lon?.toFixed(2) || 'N/A'}</td>
                    <td style="padding: 0.8rem; color: #f093fb;">${item.type || params.category}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;

        // Pagination
        const totalPages = Math.ceil(result.total / this.pageSize);
        pagination.innerHTML = `
          <div style="display: flex; justify-content: center; align-items: center; gap: 1rem; margin-top: 1rem;">
            <button onclick="app.changePage(${this.currentPage - 1})" 
                    ${this.currentPage <= 1 ? 'disabled' : ''} 
                    class="btn-3d" style="padding: 0.5rem 1rem;">Previous</button>
            <span style="color: #fff;">Page ${this.currentPage} of ${totalPages}</span>
            <button onclick="app.changePage(${this.currentPage + 1})" 
                    ${this.currentPage >= totalPages ? 'disabled' : ''} 
                    class="btn-3d" style="padding: 0.5rem 1rem;">Next</button>
          </div>
        `;
        
        container.style.display = 'block';
        container.classList.add('fade-in');
      }

      changePage(newPage) {
        if (newPage >= 1) {
          this.currentPage = newPage;
          this.browseData();
        }
      }

      // Wiki Sync Methods
      async loadSyncStatus() {
        try {
          const response = await fetch('/sync/status');
          if (response.ok) {
            const status = await response.json();
            document.getElementById('lastSyncTime').textContent = status.lastSync || 'Never';
            document.getElementById('totalRecords').textContent = status.totalRecords || '0';
            document.getElementById('wikiStatus').textContent = status.wikiConnected ? 'Connected' : 'Disconnected';
          }
        } catch (error) {
          console.error('Failed to load sync status:', error);
          document.getElementById('wikiStatus').textContent = 'Error';
        }
      }

      async testWikiConnection() {
        this.updateStatus('Testing wiki connection...', 'loading');
        
        try {
          const response = await fetch('/wiki/test');
          const result = await response.json();
          
          if (response.ok) {
            document.getElementById('wikiStatus').textContent = 'Connected';
            this.showSuccess('Wiki connection successful!');
            this.updateStatus('Wiki Connected', 'success');
          } else {
            throw new Error(result.error || 'Connection failed');
          }
        } catch (error) {
          document.getElementById('wikiStatus').textContent = 'Failed';
          this.showError(`Wiki connection failed: ${error.message}`);
          this.updateStatus('Connection Failed', 'error');
        }
      }

      async performSync(fullSync = true) {
        const map = document.getElementById('syncMapSelect').value;
        const category = document.getElementById('syncTypeSelect').value;
        
        const syncType = fullSync ? 'Full Sync' : 'Delta Sync';
        this.updateStatus(`${syncType} in progress...`, 'loading');
        
        // Show progress panel
        const progressPanel = document.getElementById('syncProgress');
        const progressContent = document.getElementById('syncProgressContent');
        const progressBar = document.getElementById('syncProgressBar');
        
        progressPanel.style.display = 'block';
        progressContent.innerHTML = `Starting ${syncType.toLowerCase()}...`;
        progressBar.style.width = '10%';

        try {
          const response = await fetch('/sync/start', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              map: map || null,
              category: category || null,
              fullSync
            })
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          // Start polling for progress
          const syncId = await response.json();
          this.pollSyncProgress(syncId.syncId);

        } catch (error) {
          console.error('Sync error:', error);
          this.showError(`${syncType} failed: ${error.message}`);
          this.updateStatus('Sync Failed', 'error');
          progressPanel.style.display = 'none';
        }
      }

      async pollSyncProgress(syncId) {
        const progressContent = document.getElementById('syncProgressContent');
        const progressBar = document.getElementById('syncProgressBar');
        const resultsPanel = document.getElementById('syncResults');
        const resultsContent = document.getElementById('syncResultsContent');

        const pollInterval = setInterval(async () => {
          try {
            const response = await fetch(`/sync/progress/${syncId}`);
            const progress = await response.json();

            if (response.ok) {
              progressContent.innerHTML = `
                <div>Status: ${progress.status}</div>
                <div>Current: ${progress.current || 'Initializing...'}</div>
                <div>Progress: ${progress.completed || 0}/${progress.total || 0}</div>
              `;
              
              const percentage = progress.total > 0 ? (progress.completed / progress.total) * 100 : 0;
              progressBar.style.width = `${Math.min(percentage, 100)}%`;

              if (progress.status === 'completed') {
                clearInterval(pollInterval);
                document.getElementById('syncProgress').style.display = 'none';
                
                resultsContent.innerHTML = `
                  <div class="grid-3d">
                    <div class="result-card-3d">
                      <h4 style="color: #4facfe; margin-bottom: 1rem;">Sync Completed Successfully</h4>
                      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                          <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Records Added</div>
                          <div style="font-weight: 600; color: #00f2fe;">${progress.results?.added || 0}</div>
                        </div>
                        <div>
                          <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Records Updated</div>
                          <div style="font-weight: 600; color: #f093fb;">${progress.results?.updated || 0}</div>
                        </div>
                        <div>
                          <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Duration</div>
                          <div style="font-weight: 600; color: #fff;">${progress.duration || 'Unknown'}</div>
                        </div>
                        <div>
                          <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Maps Synced</div>
                          <div style="font-weight: 600; color: #fff;">${progress.results?.maps || 0}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                `;
                
                resultsPanel.style.display = 'block';
                this.updateStatus('Sync Completed', 'success');
                this.loadSyncStatus(); // Refresh status
                
              } else if (progress.status === 'failed') {
                clearInterval(pollInterval);
                document.getElementById('syncProgress').style.display = 'none';
                this.showError(`Sync failed: ${progress.error || 'Unknown error'}`);
                this.updateStatus('Sync Failed', 'error');
              }
            }
          } catch (error) {
            console.error('Progress polling error:', error);
            clearInterval(pollInterval);
            document.getElementById('syncProgress').style.display = 'none';
            this.showError('Failed to get sync progress');
            this.updateStatus('Sync Failed', 'error');
          }
        }, 2000); // Poll every 2 seconds
      }

      showSuccess(message) {
        // Create 3D success notification
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed; top: 2rem; left: 50%; transform: translateX(-50%);
          background: linear-gradient(135deg, #28a745, #20c997);
          color: white; padding: 1rem 2rem; border-radius: 15px;
          box-shadow: 0 10px 30px rgba(40, 167, 69, 0.3);
          z-index: 10000; animation: fadeIn 0.3s ease;
        `;
        notification.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
        document.body.appendChild(notification);
        
        setTimeout(() => notification.remove(), 4000);
      }

      loadMapImage(mapName) {
        this.currentMap = mapName;
        const mapImage = document.getElementById('mapImage');
        const mapContainer = document.getElementById('mapContainer');
        
        if (this.mapImages[mapName]) {
          mapImage.src = this.mapImages[mapName];
          mapImage.onload = () => {
            mapContainer.style.display = 'block';
            mapContainer.classList.add('fade-in');
          };
        }
      }

      async performSearch() {
        const map = document.getElementById('mapSelect').value;
        const type = document.getElementById('typeSelect').value;
        const lat = parseFloat(document.getElementById('lat').value);
        const lon = parseFloat(document.getElementById('lon').value);

        if (!map || !type || isNaN(lat) || isNaN(lon)) {
          this.showError('Please fill in all fields with valid values');
          return;
        }

        this.showLoading(true);
        this.updateStatus('Searching...', 'loading');

        try {
          const response = await fetch('/nearest', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ map, type, lat, lon })
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const results = await response.json();
          this.currentResults = results;
          
          this.displayResults(results, { map, type, lat, lon });
          this.updateMapMarkers(results, { lat, lon });
          this.updateStatus('Search Complete', 'success');

        } catch (error) {
          console.error('Search error:', error);
          this.showError(`Search failed: ${error.message}`);
          this.updateStatus('Search Failed', 'error');
        } finally {
          this.showLoading(false);
        }
      }

      displayResults(results, searchParams) {
        const container = document.getElementById('resultsContainer');
        const resultsDiv = document.getElementById('results');
        
        if (!results || results.length === 0) {
          resultsDiv.innerHTML = `
            <div class="result-card-3d text-center">
              <i class="fas fa-search" style="font-size: 3rem; color: rgba(255,255,255,0.3); margin-bottom: 1rem;"></i>
              <h3>No Results Found</h3>
              <p>No locations found near the specified coordinates.</p>
            </div>
          `;
          container.style.display = 'block';
          return;
        }

        // Display up to 5 nearest results with 3D cards
        const limitedResults = results.slice(0, 5);
        resultsDiv.innerHTML = limitedResults.map((result, index) => `
          <div class="result-card-3d" style="animation-delay: ${index * 0.1}s;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
              <h3 style="color: #fff; margin: 0;">${result.name}</h3>
              <span style="background: var(--primary-gradient); padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
                #${index + 1}
              </span>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
              <div>
                <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Latitude</div>
                <div style="font-weight: 600; color: #4facfe;">${result.coords[0].toFixed(2)}</div>
              </div>
              <div>
                <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Longitude</div>
                <div style="font-weight: 600; color: #00f2fe;">${result.coords[1].toFixed(2)}</div>
              </div>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">Distance</div>
                <div style="font-weight: 600; color: #f093fb;">${result.distance.toFixed(2)} km</div>
              </div>
              <button class="btn-3d" style="padding: 0.5rem 1rem; font-size: 0.8rem;" onclick="app.focusOnLocation(${result.coords[0]}, ${result.coords[1]})">
                <i class="fas fa-crosshairs"></i> Focus
              </button>
            </div>

            <!-- Mini Map with Grid -->
            <div style="margin-top: 1rem; position: relative; height: 150px; border-radius: 10px; overflow: hidden; background: rgba(0,0,0,0.3);">
              <img src="${this.mapImages[searchParams.map]}" 
                   style="width: 100%; height: 100%; object-fit: cover; opacity: 0.7;" 
                   alt="Mini Map" />
              
              <!-- Coordinate Grid Overlay for Mini Map -->
              <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
                          background-image: linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px),
                                          linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px);
                          background-size: 15px 15px;"></div>
              
              <!-- Location Marker -->
              <div style="position: absolute; 
                          left: ${this.coordToPercent(result.coords[1], 'lon')}%; 
                          top: ${this.coordToPercent(result.coords[0], 'lat')}%;
                          width: 12px; height: 12px; background: var(--secondary-gradient); 
                          border-radius: 50%; border: 2px solid white; 
                          transform: translate(-50%, -50%);
                          animation: markerPulse 2s ease-in-out infinite;"></div>
              
              <!-- Search Point Marker -->
              <div style="position: absolute; 
                          left: ${this.coordToPercent(searchParams.lon, 'lon')}%; 
                          top: ${this.coordToPercent(searchParams.lat, 'lat')}%;
                          width: 8px; height: 8px; background: #ffff00; 
                          border-radius: 50%; border: 1px solid white; 
                          transform: translate(-50%, -50%);"></div>
            </div>
            
            <!-- Coordinate Display -->
            <div style="margin-top: 0.5rem; font-size: 0.8rem; color: rgba(255,255,255,0.6); text-align: center;">
              Grid: ${this.formatCoordinates(result.coords[0], result.coords[1])}
            </div>
          </div>
        `).join('');

        container.style.display = 'block';
        container.classList.add('fade-in');
      }

      coordToPercent(coord, type) {
        // Convert ARK coordinates to percentage for map positioning
        // ARK maps typically use 0-100 coordinate system
        if (type === 'lat') {
          return Math.max(0, Math.min(100, 100 - coord)); // Invert Y axis
        } else {
          return Math.max(0, Math.min(100, coord));
        }
      }

      formatCoordinates(lat, lon) {
        // Format coordinates in a readable grid format
        const latChar = String.fromCharCode(65 + Math.floor(lat / 10));
        const lonNum = Math.floor(lon / 10);
        return `${latChar}${lonNum} (${lat.toFixed(1)}, ${lon.toFixed(1)})`;
      }

      updateMapMarkers(results, searchPoint) {
        const markersContainer = document.getElementById('mapMarkers');
        if (!markersContainer) return;

        markersContainer.innerHTML = '';

        // Add search point marker
        const searchMarker = document.createElement('div');
        searchMarker.className = 'map-marker-3d';
        searchMarker.style.left = `${this.coordToPercent(searchPoint.lon, 'lon')}%`;
        searchMarker.style.top = `${this.coordToPercent(searchPoint.lat, 'lat')}%`;
        searchMarker.style.background = '#ffff00';
        searchMarker.title = `Search Point: ${searchPoint.lat}, ${searchPoint.lon}`;
        markersContainer.appendChild(searchMarker);

        // Add result markers
        results.slice(0, 5).forEach((result, index) => {
          const marker = document.createElement('div');
          marker.className = 'map-marker-3d';
          marker.style.left = `${this.coordToPercent(result.coords[1], 'lon')}%`;
          marker.style.top = `${this.coordToPercent(result.coords[0], 'lat')}%`;
          marker.style.animationDelay = `${index * 0.2}s`;
          marker.title = `${result.name}: ${result.coords[0]}, ${result.coords[1]}`;
          marker.addEventListener('click', () => this.showLocationDetails(result));
          markersContainer.appendChild(marker);
        });
      }

      focusOnLocation(lat, lon) {
        // Add focus effect to main map
        const mapImage = document.getElementById('mapImage');
        const mapContainer = document.querySelector('.map-container-3d');
        
        // Highlight effect
        mapContainer.style.border = '3px solid rgba(102, 126, 234, 0.8)';
        mapContainer.style.boxShadow = '0 0 30px rgba(102, 126, 234, 0.5)';
        
        setTimeout(() => {
          mapContainer.style.border = '1px solid var(--glass-border)';
          mapContainer.style.boxShadow = 'var(--shadow-3d)';
        }, 2000);

        // Scroll to map
        mapContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }

      showLocationDetails(location) {
        // Create a detailed popup for location
        const popup = document.createElement('div');
        popup.style.cssText = `
          position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
          background: var(--glass-bg); backdrop-filter: blur(20px);
          border: 1px solid var(--glass-border); border-radius: 20px;
          padding: 2rem; max-width: 400px; z-index: 10000;
          box-shadow: var(--shadow-hover);
        `;
        
        popup.innerHTML = `
          <h3 style="color: #fff; margin-bottom: 1rem;">${location.name}</h3>
          <p><strong>Coordinates:</strong> ${location.coords[0].toFixed(2)}, ${location.coords[1].toFixed(2)}</p>
          <p><strong>Distance:</strong> ${location.distance.toFixed(2)} km</p>
          <p><strong>Grid:</strong> ${this.formatCoordinates(location.coords[0], location.coords[1])}</p>
          <button onclick="this.parentElement.remove()" class="btn-3d" style="margin-top: 1rem;">Close</button>
        `;
        
        document.body.appendChild(popup);
        
        // Auto remove after 5 seconds
        setTimeout(() => popup.remove(), 5000);
      }

      toggleCoordinateGrid() {
        const grid = document.getElementById('coordinateGrid');
        grid.classList.toggle('active');
        
        const button = document.getElementById('toggleGrid');
        if (grid.classList.contains('active')) {
          button.innerHTML = '<i class="fas fa-th"></i> Hide Grid';
        } else {
          button.innerHTML = '<i class="fas fa-th"></i> Show Grid';
        }
      }

      resetMapView() {
        const mapImage = document.getElementById('mapImage');
        const mapContainer = document.querySelector('.map-container-3d');
        
        mapImage.style.transform = 'scale(1) rotateX(0deg)';
        mapContainer.style.border = '1px solid var(--glass-border)';
        mapContainer.style.boxShadow = 'var(--shadow-3d)';
        
        // Reset grid
        const grid = document.getElementById('coordinateGrid');
        grid.classList.remove('active');
        document.getElementById('toggleGrid').innerHTML = '<i class="fas fa-th"></i> Show Grid';
      }

      showLoading(show) {
        const indicator = document.getElementById('loadingIndicator');
        indicator.style.display = show ? 'flex' : 'none';
      }

      showError(message) {
        // Create 3D error notification
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed; top: 2rem; left: 50%; transform: translateX(-50%);
          background: linear-gradient(135deg, #dc3545, #c82333);
          color: white; padding: 1rem 2rem; border-radius: 15px;
          box-shadow: 0 10px 30px rgba(220, 53, 69, 0.3);
          z-index: 10000; animation: fadeIn 0.3s ease;
        `;
        notification.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
        document.body.appendChild(notification);
        
        setTimeout(() => notification.remove(), 4000);
      }

      updateStatus(text, type) {
        const statusText = document.getElementById('statusText');
        const statusDot = document.querySelector('.status-dot');
        
        statusText.textContent = text;
        
        const gradients = {
          success: 'var(--success-gradient)',
          error: 'linear-gradient(135deg, #dc3545, #c82333)',
          loading: 'linear-gradient(135deg, #ffc107, #fd7e14)'
        };
        
        statusDot.style.background = gradients[type] || gradients.success;
      }
    }

    // Tab switching functionality
    function switchTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remove active class from all nav tabs
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected tab content
      document.getElementById(tabName + 'Tab').classList.add('active');
      
      // Add active class to clicked nav tab
      event.target.classList.add('active');
      
      // Reset current page for browse tab
      if (tabName === 'browse') {
        app.currentPage = 1;
      }
    }

    // Initialize the application
    const app = new ASAMaps3D();

    // Removed mouse shake effects - keeping minimal 3D hover effects only
  </script>
  
  <!-- Enhanced Map System -->
  <script src="/enhanced-map-system.js"></script>
</body>
</html>
